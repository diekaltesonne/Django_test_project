{% extends "calc/base.html" %}
{% load static %}
{% block title %}
{% endblock %}
{% block content %}
    {% for str, trucks in context.items %}
        <table class = "Storage">
            <tr>
                <td>Название скалада</td>
                <td>Объем до разгрузки, т </td>
                <td>Объем после разгрузки, т </td>
                <td>Качественные хар-ки после разгрузки </td>
            </tr>
        </table>
        <table class = "Storage">
            <tr>
                <td>{{str.name}}</td>
                <td>{{str.capacity}}</td>
                <td>{{str.capacity}}</td>
                <td>{{str.percentage_SiO2}} SiO2, {{str.percentage_Fe}} Fe</td>
            </tr>
        </table>
        <table>
            <tr>
                <td>Бортовой номер</td>
                <td>Модель</td>
                <td>Макс. груоподъемность, т</td>
                <td>Текущий вес, т</td>
                <td>Перегруз, %</td>
                <td>Координаты разгрузки, (X,Y)</td> 
            </tr>
        </table>
        <table class = "Trucks">
            {% for truck in trucks %}
                <tr>
                    <td class = 'truck_id'>{{truck.id}}</td>
                    <td>{{truck.name}}</td>
                    <td>{{truck.model}}</td>
                    <td>{{truck.max_carrying_capacity}}</td>
                    <td>{{truck.carrying_capacity}}</td>
                    <td>{{truck.overload}}</td>
                    <td>
                        <input id="point_x_input" type="number" value=0 size=1 title="X">
                        <input id="point_y_input" type="number" value=0 size=1 title="Y">
                    </td> 
                </tr>
            {% endfor %}
        </table>
    {% endfor %}
    <input type="hidden" name="token" value="{{csrf_token}}"/>
    <input id="submit-btn" type="submit" value="Сalculate"/>
    <script>
        $(document).on('click', '#submit-btn', function(event){
            var response_data = []
            var trucks_data = $('.Trucks');
            for(i=0;i<trucks_data.length;i++){
                var truck_id = $(trucks_data[i]).find('.truck_id').text();
                var coordinate_x = $(trucks_data[i]).find('#point_x_input').val();
                var coordinate_y = $(trucks_data[i]).find('#point_y_input').val();
                var truck_data = {
                    "truck_id": truck_id,
                    "coordinate_x": coordinate_x,
                    "coordinate_y": coordinate_y
                }
                response_data.push(truck_data);
            }
            $.ajax({
                    type: "POST",
                    url: "url_to_your_view/",
                    data: {data: JSON.stringify(response_data),
                           csrfmiddlewaretoken: '{{ csrf_token }}'},
                    success: function(response){
                        alert("Success");
                    }
                });
            });
    </script>
{% endblock %}


